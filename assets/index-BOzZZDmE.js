(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function l(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=l(n);fetch(n.href,r)}})();const F="0.3.0";function Q(){const e=new Date().toLocaleString(),t=["color: #61dafb","background-color: #222","padding: 4px 8px","border-radius: 4px","font-family: monospace"].join(";");console.log(`%c♕ Queens Game v${F} | ${e} ♕`,t)}typeof window<"u"&&(Q(),performance?.mark&&performance.mark("game_init_start"));async function G(e){try{let t;switch(e){case 7:t=await fetch("src/assets/boards/boards7.txt");break;case 8:t=await fetch("src/assets/boards/boards8.txt");break;case 9:t=await fetch("src/assets/boards/boards9.txt");break;case 10:t=await fetch("src/assets/boards/boards10.txt");break;default:throw new Error("Board size of "+e+" not valid")}const o=(await t.text()).trim().split(`
`).filter(a=>a.trim().length>0),n=Math.floor(Math.random()*o.length),r=o[n];return JSON.parse(r)}catch(t){return console.error("Could not load the board:",t),null}}let f=0,x=null;const J=document.getElementById("timer");function K(e){clearInterval(x);const t=localStorage.getItem("gameCompleted")==="true",l=JSON.parse(localStorage.getItem("miliseconds"));l!==null&&typeof l=="number"&&(f=l),C(),!t&&(e&&(f=0,localStorage.setItem("miliseconds",JSON.stringify(f)),C()),x=setInterval(V,10))}function V(){f+=10,localStorage.setItem("miliseconds",JSON.stringify(f));const e=Math.floor(f/1e3),t=Math.floor(e/3600),l=Math.floor(e%3600/60),o=e%60,n=Math.floor(f%1e3/10),r=`${String(t).padStart(2,"0")}:${String(l).padStart(2,"0")}:${String(o).padStart(2,"0")}.${String(n).padStart(2,"0")}`;J.textContent=r}function C(){const e=Math.floor(f/1e3),t=Math.floor(e/3600),l=Math.floor(e%3600/60),o=e%60,n=Math.floor(f%1e3/10),r=`${String(t).padStart(2,"0")}:${String(l).padStart(2,"0")}:${String(o).padStart(2,"0")}.${String(n).padStart(2,"0")}`;J.textContent=r}function N(){clearInterval(x),x=null}function W(){return f}const p={},q={place:.4,remove:.38,win:0},k={place:1.2,remove:.45,win:1},M={place:1,remove:1.85,win:1},S={place:.25,remove:.25,win:.3};let I=!1;function U(){p.place=new Audio("src/assets/audio/place.mp3"),p.remove=new Audio("src/assets/audio/place.mp3"),p.win=new Audio("src/assets/audio/win.mp3"),p.place.volume=S.place,p.remove.volume=S.remove,p.win.volume=S.win}function $(e){if(!I){if(!p[e]){console.warn(`Sound "${e}" not loaded`);return}try{const t=new Audio(p[e].src);t.currentTime=q[e],t.playbackRate=k[e]*M[e],t.volume=S[e],t.play().catch(l=>{console.warn("Audio play failed:",l);try{const o=new Audio(`src/assets/audio/${e==="remove"?"place":e}.mp3`);o.currentTime=q[e],o.playbackRate=k[e]*M[e],o.volume=S[e],o.play()}catch(o){console.warn("Fallback failed:",o)}})}catch(t){console.warn("Sound playback error:",t)}}}function X(){const e=()=>{const t=new Audio;t.volume=0,t.play().then(()=>t.remove()),document.removeEventListener("click",e),document.removeEventListener("touchstart",e)};document.addEventListener("click",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0})}U();X();document.getElementById("volume").addEventListener("click",()=>{const e=document.getElementById("volume");I?(e.classList.remove("volume_off"),e.classList.add("volume_on"),I=!1):(e.classList.remove("volume_on"),e.classList.add("volume_off"),I=!0)});let c=null,B=null,d=null,m=!1,w=!1,v=null,y=new Set,b=null,_=!0;window.addEventListener("blur",()=>{w=!1,v=null,y.clear()});document.addEventListener("mousedown",e=>{if(!m&&!(e.button!==0&&e.button!==2)&&(w=!0,v=e.button,y.clear(),_=!0,e.target.closest("td"))){const t=e.target.closest("td"),[l,o,n]=t.id.split("_").map(Number);L(o,n,v===0?1:2)}});document.addEventListener("mouseup",e=>{e.button===v&&(w=!1,v=null,b=setTimeout(()=>y.clear(),50))});document.getElementById("board").addEventListener("contextmenu",e=>e.preventDefault());document.getElementById("board_table").addEventListener("contextmenu",e=>e.preventDefault());function A(){w=!1,v=null,y.clear(),_=!0,b&&(clearTimeout(b),b=null)}async function z(e,t){document.getElementById("timer").style.color="var(--color_text)",document.getElementById("timer").style.textShadow="0 0 0px #00000000",B=e,d=B.length;let l=!0;const o=localStorage.getItem("queens_matrix");if(m=localStorage.getItem("gameCompleted")==="true",o&&!t)try{const r=JSON.parse(o);if(Array.isArray(r)&&r.length===d)c=r,l=!1;else throw new Error("Invalid size")}catch{O(),localStorage.setItem("queens_matrix",JSON.stringify(c))}else O(),localStorage.setItem("queens_matrix",JSON.stringify(c));D(),Y(),m?N():K(l&&!m),j()}function D(){for(let e=0;e<d;e++)for(let t=0;t<d;t++)R(e,t)}function R(e,t){const l=document.getElementById(`cell_${e}_${t}`);if(!l)return;const o=c[e][t];if(l.innerHTML="",o===1){const n=document.createElement("div");n.className="board_icons icon_queen",n.dataset.row=e,n.dataset.col=t,l.appendChild(n)}else if(o===2){const n=document.createElement("div");n.className="board_icons icon_cross",l.appendChild(n)}}function L(e,t,l){if(m||!Z(e,t))return;const o=`${e}_${t}`;if(!y.has(o)){if(y.add(o),c[e][t],l===1){const n=c[e][t]===1;c[e][t]=n?0:1,_&&(c[e][t]===1?$("place"):n&&$("remove"))}else l===2&&(c[e][t]=c[e][t]===2?0:2);_=!1,R(e,t),localStorage.setItem("queens_matrix",JSON.stringify(c)),j()}}function Y(){for(let e=0;e<d;e++)for(let t=0;t<d;t++){const l=document.getElementById(`cell_${e}_${t}`);if(!l)continue;const o=l.cloneNode(!0);l.replaceWith(o),o.addEventListener("mouseenter",()=>{w&&!m&&L(e,t,v===2?2:1)}),o.addEventListener("click",n=>{n.button===0&&!m&&(_=!0,L(e,t,1))}),o.addEventListener("contextmenu",n=>{n.preventDefault(),m||(_=!0,L(e,t,2))})}}function O(){m=!1,localStorage.setItem("gameCompleted","false"),A(),c=[];for(let e=0;e<d;e++){c[e]=[];for(let t=0;t<d;t++){c[e][t]=0;const l=document.getElementById(`cell_${e}_${t}`);l&&(l.innerHTML="")}}}function Z(e,t){return e>=0&&e<d&&t>=0&&t<d}document.getElementById("clear_board").addEventListener("click",()=>{m||(O(),localStorage.setItem("queens_matrix",JSON.stringify(c)),D())});let T=[];function j(){if(m)return!0;T=[];let e=!0;const t=[],l={};for(let n=0;n<d;n++)for(let r=0;r<d;r++){const s=document.getElementById(`cell_${n}_${r}`);if(s){const a=s.querySelector(".icon_queen");a&&a.classList.remove("invalid_queen")}if(c[n][r]===1){const a=B[n][r];t.push({row:n,col:r,color:a}),l[a]=(l[a]||0)+1}}for(let n=0;n<t.length;n++){let r=!1;for(let s=0;s<t.length;s++){if(n===s)continue;const a=t[n],E=t[s];(a.row===E.row||a.col===E.col||a.color===E.color||Math.abs(a.row-E.row)===1&&Math.abs(a.col-E.col)===1)&&(r=!0)}if(r){T.push([t[n].row,t[n].col]);const s=document.querySelector(`#cell_${t[n].row}_${t[n].col} .icon_queen`);s&&s.classList.add("invalid_queen"),e=!1}}const o=new Set(B.flat());for(const n of o)if(l[n]!==1){e=!1;break}return e&&t.length>0&&(m=!0,localStorage.setItem("gameCompleted","true"),localStorage.setItem("miliseconds",JSON.stringify(W())),A(),N(),$("win"),ee(),document.getElementById("timer").style.color="var(--timer_victory_color)",document.getElementById("timer").style.textShadow="0 0 10px #61e82c"),e}function ee(){for(let e=0;e<d;e++){const t=e*.3;for(let l=0;l<d;l++){const o=document.getElementById(`cell_${e}_${l}`);o&&(o.classList.add("victory_row"),o.style.animationDelay=`${t}s`)}}}let g=null;document.addEventListener("DOMContentLoaded",async()=>{const e=localStorage.getItem("colors_matrix");if(e){g=JSON.parse(e);const t=g.length;H(t,g),z(g,!1)}else await P()});document.getElementById("new_game").addEventListener("click",P);async function P(){const e=parseInt(document.getElementById("size").value);g=await G(e),g?(H(e,g),z(g,!0),localStorage.setItem("colors_matrix",JSON.stringify(g))):alert("Could not load the board")}function H(e,t){const l=document.getElementById("board");l.innerHTML="";for(let o=0;o<e;o++){const n=document.createElement("tr");for(let r=0;r<e;r++){const s=document.createElement("td"),a=t[o][r];s.id=`cell_${o}_${r}`,s.className=`cell_color_${a}`,n.appendChild(s)}l.appendChild(n)}}let u={grid:null,visual_help:null,theme:null,difficulty:null,size:null};const i=document;function te(){const e=localStorage.getItem("stored_selections");if(e)try{u=JSON.parse(e),i.getElementById("grid_selector").value=u.grid,i.getElementById("visual_settings").value=u.visual_help,i.getElementById("theme_selector").value=u.theme,i.getElementById("dificulty").value=u.difficulty,i.getElementById("size").value=u.size}catch(t){console.warn("Error parsing stored selections",t)}}function h(){u.grid=i.getElementById("grid_selector").value,u.visual_help=i.getElementById("visual_settings").value,u.theme=i.getElementById("theme_selector").value,u.difficulty=i.getElementById("dificulty").value,u.size=i.getElementById("size").value,localStorage.setItem("stored_selections",JSON.stringify(u))}window.addEventListener("DOMContentLoaded",te);window.addEventListener("beforeunload",h);i.getElementById("grid_selector").addEventListener("change",h);i.getElementById("visual_settings").addEventListener("change",h);i.getElementById("theme_selector").addEventListener("change",h);i.getElementById("dificulty").addEventListener("change",h);i.getElementById("size").addEventListener("change",h);
