(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();const P="0.2.0";function R(){const e=new Date().toLocaleString(),t=["color: #61dafb","background-color: #222","padding: 4px 8px","border-radius: 4px","font-family: monospace"].join(";");console.log(`%c♕ Queens Game v${P} | ${e} ♕`,t)}typeof window<"u"&&(R(),performance?.mark&&performance.mark("game_init_start"));async function H(e){try{let t;switch(e){case 7:t=await fetch("src/assets/boards/boards7.txt");break;case 8:t=await fetch("src/assets/boards/boards8.txt");break;case 9:t=await fetch("src/assets/boards/boards9.txt");break;case 10:t=await fetch("src/assets/boards/boards10.txt");break;default:throw new Error("Board size of "+e+" not valid")}const n=(await t.text()).trim().split(`
`).filter(s=>s.trim().length>0),o=Math.floor(Math.random()*n.length),l=n[o];return JSON.parse(l)}catch(t){return console.error("Could not load the board:",t),null}}let u=0,E=null;const M=document.getElementById("timer");function F(e){clearInterval(E);const t=localStorage.getItem("gameCompleted")==="true",r=JSON.parse(localStorage.getItem("miliseconds"));r!==null&&typeof r=="number"&&(u=r),x(),!t&&(e&&(u=0,localStorage.setItem("miliseconds",JSON.stringify(u)),x()),E=setInterval(Q,10))}function Q(){u+=10,localStorage.setItem("miliseconds",JSON.stringify(u));const e=Math.floor(u/1e3),t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=e%60,o=Math.floor(u%1e3/10),l=`${String(t).padStart(2,"0")}:${String(r).padStart(2,"0")}:${String(n).padStart(2,"0")}.${String(o).padStart(2,"0")}`;M.textContent=l}function x(){const e=Math.floor(u/1e3),t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=e%60,o=Math.floor(u%1e3/10),l=`${String(t).padStart(2,"0")}:${String(r).padStart(2,"0")}:${String(n).padStart(2,"0")}.${String(o).padStart(2,"0")}`;M.textContent=l}function T(){clearInterval(E),E=null}function G(){return u}const f={},B={place:.4,remove:.38,win:0},C={place:1.2,remove:.45,win:1},O={place:1,remove:1.85,win:1},y={place:.6,remove:.5,win:.5};let h=!1;function K(){f.place=new Audio("src/assets/audio/place.mp3"),f.remove=new Audio("src/assets/audio/place.mp3"),f.win=new Audio("src/assets/audio/win.mp3"),f.place.volume=y.place,f.remove.volume=y.remove,f.win.volume=y.win}function L(e){if(!h){if(!f[e]){console.warn(`Sound "${e}" not loaded`);return}try{const t=new Audio(f[e].src);t.currentTime=B[e],t.playbackRate=C[e]*O[e],t.volume=y[e],t.play().catch(r=>{console.warn("Audio play failed:",r);try{const n=new Audio(`src/assets/audio/${e==="remove"?"place":e}.mp3`);n.currentTime=B[e],n.playbackRate=C[e]*O[e],n.volume=y[e],n.play()}catch(n){console.warn("Fallback failed:",n)}})}catch(t){console.warn("Sound playback error:",t)}}}function V(){const e=()=>{const t=new Audio;t.volume=0,t.play().then(()=>t.remove()),document.removeEventListener("click",e),document.removeEventListener("touchstart",e)};document.addEventListener("click",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0})}K();V();document.getElementById("volume").addEventListener("click",()=>{const e=document.getElementById("volume");h?(e.classList.remove("volume_off"),e.classList.add("volume_on"),h=!1):(e.classList.remove("volume_on"),e.classList.add("volume_off"),h=!0)});let c=null,I=null,i=null,d=!1,S=!1,p=null,g=new Set,w=null,v=!0;window.addEventListener("blur",()=>{S=!1,p=null,g.clear()});document.addEventListener("mousedown",e=>{if(!d&&!(e.button!==0&&e.button!==2)&&(S=!0,p=e.button,g.clear(),v=!0,e.target.closest("td"))){const t=e.target.closest("td"),[r,n,o]=t.id.split("_").map(Number);b(n,o,p===0?1:2)}});document.addEventListener("mouseup",e=>{e.button===p&&(S=!1,p=null,w=setTimeout(()=>g.clear(),50))});document.getElementById("board").addEventListener("contextmenu",e=>e.preventDefault());document.getElementById("board_table").addEventListener("contextmenu",e=>e.preventDefault());function z(){S=!1,p=null,g.clear(),v=!0,w&&(clearTimeout(w),w=null)}async function q(e,t){document.getElementById("timer").style.color="var(--color_text)",document.getElementById("timer").style.textShadow="0 0 0px #00000000",I=e,i=I.length;let r=!0;const n=localStorage.getItem("matriz_reinas");if(d=localStorage.getItem("gameCompleted")==="true",n&&!t)try{const l=JSON.parse(n);if(Array.isArray(l)&&l.length===i)c=l,r=!1;else throw new Error("Tamaño inválido")}catch{$(),localStorage.setItem("matriz_reinas",JSON.stringify(c))}else $(),localStorage.setItem("matriz_reinas",JSON.stringify(c));A(),W(),d?T():F(r&&!d),N()}function A(){for(let e=0;e<i;e++)for(let t=0;t<i;t++)J(e,t)}function J(e,t){const r=document.getElementById(`cell_${e}_${t}`);if(!r)return;const n=c[e][t];if(r.innerHTML="",n===1){const o=document.createElement("div");o.className="board_icons icon_queen",o.dataset.row=e,o.dataset.col=t,r.appendChild(o)}else if(n===2){const o=document.createElement("div");o.className="board_icons icon_cross",r.appendChild(o)}}function b(e,t,r){if(d||!U(e,t))return;const n=`${e}_${t}`;if(!g.has(n)){if(g.add(n),c[e][t],r===1){c[e][t];const o=c[e][t]===1;c[e][t]=o?0:1,v&&(c[e][t]===1?L("place"):o&&L("remove"))}else r===2&&(c[e][t]=c[e][t]===2?0:2);v=!1,J(e,t),localStorage.setItem("matriz_reinas",JSON.stringify(c)),N()}}function W(){for(let e=0;e<i;e++)for(let t=0;t<i;t++){const r=document.getElementById(`cell_${e}_${t}`);if(!r)continue;const n=r.cloneNode(!0);r.replaceWith(n),n.addEventListener("mouseenter",()=>{S&&!d&&b(e,t,p===2?2:1)}),n.addEventListener("click",o=>{o.button===0&&!d&&(v=!0,b(e,t,1))}),n.addEventListener("contextmenu",o=>{o.preventDefault(),d||(v=!0,b(e,t,2))})}}function $(){d=!1,localStorage.setItem("gameCompleted","false"),z(),c=[];for(let e=0;e<i;e++){c[e]=[];for(let t=0;t<i;t++){c[e][t]=0;const r=document.getElementById(`cell_${e}_${t}`);r&&(r.innerHTML="")}}}function U(e,t){return e>=0&&e<i&&t>=0&&t<i}document.getElementById("clear_board").addEventListener("click",()=>{d||($(),localStorage.setItem("matriz_reinas",JSON.stringify(c)),A())});let k=[];function N(){if(d)return!0;k=[];let e=!0;const t=[],r={};for(let o=0;o<i;o++)for(let l=0;l<i;l++){const a=document.getElementById(`cell_${o}_${l}`);if(a){const s=a.querySelector(".icon_queen");s&&s.classList.remove("invalid_queen")}if(c[o][l]===1){const s=I[o][l];t.push({row:o,col:l,color:s}),r[s]=(r[s]||0)+1}}for(let o=0;o<t.length;o++){let l=!1;for(let a=0;a<t.length;a++){if(o===a)continue;const s=t[o],_=t[a];(s.row===_.row||s.col===_.col||s.color===_.color||Math.abs(s.row-_.row)===1&&Math.abs(s.col-_.col)===1)&&(l=!0)}if(l){k.push([t[o].row,t[o].col]);const a=document.querySelector(`#cell_${t[o].row}_${t[o].col} .icon_queen`);a&&a.classList.add("invalid_queen"),e=!1}}const n=new Set(I.flat());for(const o of n)if(r[o]!==1){e=!1;break}return e&&t.length>0&&(d=!0,localStorage.setItem("gameCompleted","true"),localStorage.setItem("miliseconds",JSON.stringify(G())),z(),T(),L("win"),X(),document.getElementById("timer").style.color="var(--timer_victory_color)",document.getElementById("timer").style.textShadow="0 0 10px #61e82c"),e}function X(){for(let e=0;e<i;e++){const t=e*.3;for(let r=0;r<i;r++){const n=document.getElementById(`cell_${e}_${r}`);n&&(n.classList.add("victory_row"),n.style.animationDelay=`${t}s`)}}}let m=null;document.addEventListener("DOMContentLoaded",async()=>{const e=localStorage.getItem("matriz_colores");if(e){m=JSON.parse(e);const t=m.length;j(t,m),q(m,!1)}else await D()});document.getElementById("new_game").addEventListener("click",D);async function D(){const e=parseInt(document.getElementById("size").value);m=await H(e),m?(j(e,m),q(m,!0),localStorage.setItem("matriz_colores",JSON.stringify(m))):alert("Could not load the board")}function j(e,t){const r=document.getElementById("board");r.innerHTML="";for(let n=0;n<e;n++){const o=document.createElement("tr");for(let l=0;l<e;l++){const a=document.createElement("td"),s=t[n][l];a.id=`cell_${n}_${l}`,a.className=`cell_color_${s}`,o.appendChild(a)}r.appendChild(o)}}
