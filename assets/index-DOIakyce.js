(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();const Q="0.3.0";function G(){const e=new Date().toLocaleString(),t=["color: #61dafb","background-color: #222","padding: 4px 8px","border-radius: 4px","font-family: monospace"].join(";");console.log(`%c♕ Queens Game v${Q} | ${e} ♕`,t)}typeof window<"u"&&(G(),performance?.mark&&performance.mark("game_init_start"));async function K(e){try{const t=`./boards${e}.js`,o=`getBoards${e}`,l=await import(t);if(!l[o])throw new Error(`Function ${o} not found`);const n=l[o](),r=Object.values(n);if(r.length===0)throw new Error(`No boards found in boards${e}.js`);const c=Math.floor(Math.random()*r.length);return r[c]}catch(t){return console.error("Board loading error:",t),null}}let f=0,B=null;const N=document.getElementById("timer");function V(e){clearInterval(B);const t=localStorage.getItem("gameCompleted")==="true",o=JSON.parse(localStorage.getItem("miliseconds"));o!==null&&typeof o=="number"&&(f=o),q(),!t&&(e&&(f=0,localStorage.setItem("miliseconds",JSON.stringify(f)),q()),B=setInterval(W,10))}function W(){f+=10,localStorage.setItem("miliseconds",JSON.stringify(f));const e=Math.floor(f/1e3),t=Math.floor(e/3600),o=Math.floor(e%3600/60),l=e%60,n=Math.floor(f%1e3/10),r=`${String(t).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(l).padStart(2,"0")}.${String(n).padStart(2,"0")}`;N.textContent=r}function q(){const e=Math.floor(f/1e3),t=Math.floor(e/3600),o=Math.floor(e%3600/60),l=e%60,n=Math.floor(f%1e3/10),r=`${String(t).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(l).padStart(2,"0")}.${String(n).padStart(2,"0")}`;N.textContent=r}function A(){clearInterval(B),B=null}function U(){return f}const p={},M={place:.4,remove:.38,win:0},T={place:1.2,remove:.45,win:1},k={place:1,remove:1.85,win:1},I={place:.25,remove:.25,win:.3};let w=!1;const x="https://elpelado619.github.io/Queens-Game/audio/";function X(){p.place=new Audio(x+"place.mp3"),p.remove=new Audio(x+"place.mp3"),p.win=new Audio(x+"win.mp3"),p.place.volume=I.place,p.remove.volume=I.remove,p.win.volume=I.win}function O(e){if(!w){if(!p[e]){console.warn(`Sound "${e}" not loaded`);return}try{const t=new Audio(p[e].src);t.currentTime=M[e],t.playbackRate=T[e]*k[e],t.volume=I[e],t.play().catch(o=>{console.warn("Audio play failed:",o);try{const l=new Audio(`/audio/${e==="remove"?"place":e}.mp3`);l.currentTime=M[e],l.playbackRate=T[e]*k[e],l.volume=I[e],l.play()}catch(l){console.warn("Fallback failed:",l)}})}catch(t){console.warn("Sound playback error:",t)}}}function Y(){const e=()=>{const t=new Audio;t.volume=0,t.play().then(()=>t.remove()),document.removeEventListener("click",e),document.removeEventListener("touchstart",e)};document.addEventListener("click",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0})}X();Y();document.getElementById("volume").addEventListener("click",()=>{const e=document.getElementById("volume");w?(e.classList.remove("volume_off"),e.classList.add("volume_on"),w=!1):(e.classList.remove("volume_on"),e.classList.add("volume_off"),w=!0)});let s=null,$=null,d=null,m=!1,S=!1,v=null,y=new Set,b=null,_=!0;window.addEventListener("blur",()=>{S=!1,v=null,y.clear()});document.addEventListener("mousedown",e=>{if(!m&&!(e.button!==0&&e.button!==2)&&(S=!0,v=e.button,y.clear(),_=!0,e.target.closest("td"))){const t=e.target.closest("td"),[o,l,n]=t.id.split("_").map(Number);L(l,n,v===0?1:2)}});document.addEventListener("mouseup",e=>{e.button===v&&(S=!1,v=null,b=setTimeout(()=>y.clear(),50))});document.getElementById("board").addEventListener("contextmenu",e=>e.preventDefault());document.getElementById("board_table").addEventListener("contextmenu",e=>e.preventDefault());function j(){S=!1,v=null,y.clear(),_=!0,b&&(clearTimeout(b),b=null)}async function z(e,t){document.getElementById("timer").style.color="var(--color_text)",document.getElementById("timer").style.textShadow="0 0 0px #00000000",$=e,d=$.length;let o=!0;const l=localStorage.getItem("queens_matrix");if(m=localStorage.getItem("gameCompleted")==="true",l&&!t)try{const r=JSON.parse(l);if(Array.isArray(r)&&r.length===d)s=r,o=!1;else throw new Error("Invalid size")}catch{C(),localStorage.setItem("queens_matrix",JSON.stringify(s))}else C(),localStorage.setItem("queens_matrix",JSON.stringify(s));D(),Z(),m?A():V(o&&!m),R()}function D(){for(let e=0;e<d;e++)for(let t=0;t<d;t++)P(e,t)}function P(e,t){const o=document.getElementById(`cell_${e}_${t}`);if(!o)return;const l=s[e][t];if(o.innerHTML="",l===1){const n=document.createElement("div");n.className="board_icons icon_queen",n.dataset.row=e,n.dataset.col=t,o.appendChild(n)}else if(l===2){const n=document.createElement("div");n.className="board_icons icon_cross",o.appendChild(n)}}function L(e,t,o){if(m||!ee(e,t))return;const l=`${e}_${t}`;if(!y.has(l)){if(y.add(l),s[e][t],o===1){const n=s[e][t]===1;s[e][t]=n?0:1,_&&(s[e][t]===1?O("place"):n&&O("remove"))}else o===2&&(s[e][t]=s[e][t]===2?0:2);_=!1,P(e,t),localStorage.setItem("queens_matrix",JSON.stringify(s)),R()}}function Z(){for(let e=0;e<d;e++)for(let t=0;t<d;t++){const o=document.getElementById(`cell_${e}_${t}`);if(!o)continue;const l=o.cloneNode(!0);o.replaceWith(l),l.addEventListener("mouseenter",()=>{S&&!m&&L(e,t,v===2?2:1)}),l.addEventListener("click",n=>{n.button===0&&!m&&(_=!0,L(e,t,1))}),l.addEventListener("contextmenu",n=>{n.preventDefault(),m||(_=!0,L(e,t,2))})}}function C(){m=!1,localStorage.setItem("gameCompleted","false"),j(),s=[];for(let e=0;e<d;e++){s[e]=[];for(let t=0;t<d;t++){s[e][t]=0;const o=document.getElementById(`cell_${e}_${t}`);o&&(o.innerHTML="")}}}function ee(e,t){return e>=0&&e<d&&t>=0&&t<d}document.getElementById("clear_board").addEventListener("click",()=>{m||(C(),localStorage.setItem("queens_matrix",JSON.stringify(s)),D())});let J=[];function R(){if(m)return!0;J=[];let e=!0;const t=[],o={};for(let n=0;n<d;n++)for(let r=0;r<d;r++){const c=document.getElementById(`cell_${n}_${r}`);if(c){const a=c.querySelector(".icon_queen");a&&a.classList.remove("invalid_queen")}if(s[n][r]===1){const a=$[n][r];t.push({row:n,col:r,color:a}),o[a]=(o[a]||0)+1}}for(let n=0;n<t.length;n++){let r=!1;for(let c=0;c<t.length;c++){if(n===c)continue;const a=t[n],E=t[c];(a.row===E.row||a.col===E.col||a.color===E.color||Math.abs(a.row-E.row)===1&&Math.abs(a.col-E.col)===1)&&(r=!0)}if(r){J.push([t[n].row,t[n].col]);const c=document.querySelector(`#cell_${t[n].row}_${t[n].col} .icon_queen`);c&&c.classList.add("invalid_queen"),e=!1}}const l=new Set($.flat());for(const n of l)if(o[n]!==1){e=!1;break}return e&&t.length>0&&(m=!0,localStorage.setItem("gameCompleted","true"),localStorage.setItem("miliseconds",JSON.stringify(U())),j(),A(),O("win"),te(),document.getElementById("timer").style.color="var(--timer_victory_color)",document.getElementById("timer").style.textShadow="0 0 10px #61e82c"),e}function te(){for(let e=0;e<d;e++){const t=e*.3;for(let o=0;o<d;o++){const l=document.getElementById(`cell_${e}_${o}`);l&&(l.classList.add("victory_row"),l.style.animationDelay=`${t}s`)}}}let g=null;document.addEventListener("DOMContentLoaded",async()=>{const e=localStorage.getItem("colors_matrix");if(e){g=JSON.parse(e);const t=g.length;H(t,g),z(g,!1)}else await F()});document.getElementById("new_game").addEventListener("click",F);async function F(){const e=parseInt(document.getElementById("size").value);g=await K(e),g?(H(e,g),z(g,!0),localStorage.setItem("colors_matrix",JSON.stringify(g))):alert("Couldn't get a new board")}function H(e,t){const o=document.getElementById("board");o.innerHTML="";for(let l=0;l<e;l++){const n=document.createElement("tr");for(let r=0;r<e;r++){const c=document.createElement("td"),a=t[l][r];c.id=`cell_${l}_${r}`,c.className=`cell_color_${a}`,n.appendChild(c)}o.appendChild(n)}}let u={grid:null,visual_help:null,theme:null,difficulty:null,size:null};const i=document;function ne(){const e=localStorage.getItem("stored_selections");if(e)try{u=JSON.parse(e),i.getElementById("grid_selector").value=u.grid,i.getElementById("visual_settings").value=u.visual_help,i.getElementById("theme_selector").value=u.theme,i.getElementById("difficulty").value=u.difficulty,i.getElementById("size").value=u.size}catch(t){console.warn("Error parsing stored selections",t)}}function h(){u.grid=i.getElementById("grid_selector").value,u.visual_help=i.getElementById("visual_settings").value,u.theme=i.getElementById("theme_selector").value,u.difficulty=i.getElementById("difficulty").value,u.size=i.getElementById("size").value,localStorage.setItem("stored_selections",JSON.stringify(u))}window.addEventListener("DOMContentLoaded",ne);window.addEventListener("beforeunload",h);i.getElementById("grid_selector").addEventListener("change",h);i.getElementById("visual_settings").addEventListener("change",h);i.getElementById("theme_selector").addEventListener("change",h);i.getElementById("difficulty").addEventListener("change",h);i.getElementById("size").addEventListener("change",h);
