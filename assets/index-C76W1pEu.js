(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();const G="0.3.0";function H(){const e=new Date().toLocaleString(),t=["color: #61dafb","background-color: #222","padding: 4px 8px","border-radius: 4px","font-family: monospace"].join(";");console.log(`%c♕ Queens Game v${G} | ${e} ♕`,t)}typeof window<"u"&&(H(),performance?.mark&&performance.mark("game_init_start"));async function K(e){try{const t="https://elpelado619.github.io/Queens-Game/boards/";let o;switch(e){case 7:o="boards7.txt";break;case 8:o="boards8.txt";break;case 9:o="boards9.txt";break;case 10:o="boards10.txt";break;default:throw new Error("Invalid board size: "+e)}const l=await fetch(t+o);if(!l.ok)throw new Error(`Failed to load ${o}`);const r=(await l.text()).trim().split(`
`).filter(s=>s.trim()),a=r[Math.floor(Math.random()*r.length)];return JSON.parse(a)}catch(t){return console.error("Board loading error:",t),null}}let f=0,B=null;const N=document.getElementById("timer");function V(e){clearInterval(B);const t=localStorage.getItem("gameCompleted")==="true",o=JSON.parse(localStorage.getItem("miliseconds"));o!==null&&typeof o=="number"&&(f=o),k(),!t&&(e&&(f=0,localStorage.setItem("miliseconds",JSON.stringify(f)),k()),B=setInterval(W,10))}function W(){f+=10,localStorage.setItem("miliseconds",JSON.stringify(f));const e=Math.floor(f/1e3),t=Math.floor(e/3600),o=Math.floor(e%3600/60),l=e%60,n=Math.floor(f%1e3/10),r=`${String(t).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(l).padStart(2,"0")}.${String(n).padStart(2,"0")}`;N.textContent=r}function k(){const e=Math.floor(f/1e3),t=Math.floor(e/3600),o=Math.floor(e%3600/60),l=e%60,n=Math.floor(f%1e3/10),r=`${String(t).padStart(2,"0")}:${String(o).padStart(2,"0")}:${String(l).padStart(2,"0")}.${String(n).padStart(2,"0")}`;N.textContent=r}function A(){clearInterval(B),B=null}function U(){return f}const p={},q={place:.4,remove:.38,win:0},M={place:1.2,remove:.45,win:1},T={place:1,remove:1.85,win:1},I={place:.25,remove:.25,win:.3};let w=!1;const $="https://elpelado619.github.io/Queens-Game/audio/";function X(){p.place=new Audio($+"place.mp3"),p.remove=new Audio($+"place.mp3"),p.win=new Audio($+"win.mp3"),p.place.volume=I.place,p.remove.volume=I.remove,p.win.volume=I.win}function O(e){if(!w){if(!p[e]){console.warn(`Sound "${e}" not loaded`);return}try{const t=new Audio(p[e].src);t.currentTime=q[e],t.playbackRate=M[e]*T[e],t.volume=I[e],t.play().catch(o=>{console.warn("Audio play failed:",o);try{const l=new Audio(`/audio/${e==="remove"?"place":e}.mp3`);l.currentTime=q[e],l.playbackRate=M[e]*T[e],l.volume=I[e],l.play()}catch(l){console.warn("Fallback failed:",l)}})}catch(t){console.warn("Sound playback error:",t)}}}function Y(){const e=()=>{const t=new Audio;t.volume=0,t.play().then(()=>t.remove()),document.removeEventListener("click",e),document.removeEventListener("touchstart",e)};document.addEventListener("click",e,{once:!0}),document.addEventListener("touchstart",e,{once:!0})}X();Y();document.getElementById("volume").addEventListener("click",()=>{const e=document.getElementById("volume");w?(e.classList.remove("volume_off"),e.classList.add("volume_on"),w=!1):(e.classList.remove("volume_on"),e.classList.add("volume_off"),w=!0)});let i=null,x=null,d=null,m=!1,S=!1,v=null,y=new Set,b=null,_=!0;window.addEventListener("blur",()=>{S=!1,v=null,y.clear()});document.addEventListener("mousedown",e=>{if(!m&&!(e.button!==0&&e.button!==2)&&(S=!0,v=e.button,y.clear(),_=!0,e.target.closest("td"))){const t=e.target.closest("td"),[o,l,n]=t.id.split("_").map(Number);L(l,n,v===0?1:2)}});document.addEventListener("mouseup",e=>{e.button===v&&(S=!1,v=null,b=setTimeout(()=>y.clear(),50))});document.getElementById("board").addEventListener("contextmenu",e=>e.preventDefault());document.getElementById("board_table").addEventListener("contextmenu",e=>e.preventDefault());function z(){S=!1,v=null,y.clear(),_=!0,b&&(clearTimeout(b),b=null)}async function D(e,t){document.getElementById("timer").style.color="var(--color_text)",document.getElementById("timer").style.textShadow="0 0 0px #00000000",x=e,d=x.length;let o=!0;const l=localStorage.getItem("queens_matrix");if(m=localStorage.getItem("gameCompleted")==="true",l&&!t)try{const r=JSON.parse(l);if(Array.isArray(r)&&r.length===d)i=r,o=!1;else throw new Error("Invalid size")}catch{C(),localStorage.setItem("queens_matrix",JSON.stringify(i))}else C(),localStorage.setItem("queens_matrix",JSON.stringify(i));P(),Z(),m?A():V(o&&!m),j()}function P(){for(let e=0;e<d;e++)for(let t=0;t<d;t++)R(e,t)}function R(e,t){const o=document.getElementById(`cell_${e}_${t}`);if(!o)return;const l=i[e][t];if(o.innerHTML="",l===1){const n=document.createElement("div");n.className="board_icons icon_queen",n.dataset.row=e,n.dataset.col=t,o.appendChild(n)}else if(l===2){const n=document.createElement("div");n.className="board_icons icon_cross",o.appendChild(n)}}function L(e,t,o){if(m||!ee(e,t))return;const l=`${e}_${t}`;if(!y.has(l)){if(y.add(l),i[e][t],o===1){const n=i[e][t]===1;i[e][t]=n?0:1,_&&(i[e][t]===1?O("place"):n&&O("remove"))}else o===2&&(i[e][t]=i[e][t]===2?0:2);_=!1,R(e,t),localStorage.setItem("queens_matrix",JSON.stringify(i)),j()}}function Z(){for(let e=0;e<d;e++)for(let t=0;t<d;t++){const o=document.getElementById(`cell_${e}_${t}`);if(!o)continue;const l=o.cloneNode(!0);o.replaceWith(l),l.addEventListener("mouseenter",()=>{S&&!m&&L(e,t,v===2?2:1)}),l.addEventListener("click",n=>{n.button===0&&!m&&(_=!0,L(e,t,1))}),l.addEventListener("contextmenu",n=>{n.preventDefault(),m||(_=!0,L(e,t,2))})}}function C(){m=!1,localStorage.setItem("gameCompleted","false"),z(),i=[];for(let e=0;e<d;e++){i[e]=[];for(let t=0;t<d;t++){i[e][t]=0;const o=document.getElementById(`cell_${e}_${t}`);o&&(o.innerHTML="")}}}function ee(e,t){return e>=0&&e<d&&t>=0&&t<d}document.getElementById("clear_board").addEventListener("click",()=>{m||(C(),localStorage.setItem("queens_matrix",JSON.stringify(i)),P())});let J=[];function j(){if(m)return!0;J=[];let e=!0;const t=[],o={};for(let n=0;n<d;n++)for(let r=0;r<d;r++){const a=document.getElementById(`cell_${n}_${r}`);if(a){const s=a.querySelector(".icon_queen");s&&s.classList.remove("invalid_queen")}if(i[n][r]===1){const s=x[n][r];t.push({row:n,col:r,color:s}),o[s]=(o[s]||0)+1}}for(let n=0;n<t.length;n++){let r=!1;for(let a=0;a<t.length;a++){if(n===a)continue;const s=t[n],E=t[a];(s.row===E.row||s.col===E.col||s.color===E.color||Math.abs(s.row-E.row)===1&&Math.abs(s.col-E.col)===1)&&(r=!0)}if(r){J.push([t[n].row,t[n].col]);const a=document.querySelector(`#cell_${t[n].row}_${t[n].col} .icon_queen`);a&&a.classList.add("invalid_queen"),e=!1}}const l=new Set(x.flat());for(const n of l)if(o[n]!==1){e=!1;break}return e&&t.length>0&&(m=!0,localStorage.setItem("gameCompleted","true"),localStorage.setItem("miliseconds",JSON.stringify(U())),z(),A(),O("win"),te(),document.getElementById("timer").style.color="var(--timer_victory_color)",document.getElementById("timer").style.textShadow="0 0 10px #61e82c"),e}function te(){for(let e=0;e<d;e++){const t=e*.3;for(let o=0;o<d;o++){const l=document.getElementById(`cell_${e}_${o}`);l&&(l.classList.add("victory_row"),l.style.animationDelay=`${t}s`)}}}let g=null;document.addEventListener("DOMContentLoaded",async()=>{const e=localStorage.getItem("colors_matrix");if(e){g=JSON.parse(e);const t=g.length;F(t,g),D(g,!1)}else await Q()});document.getElementById("new_game").addEventListener("click",Q);async function Q(){const e=parseInt(document.getElementById("size").value);g=await K(e),g?(F(e,g),D(g,!0),localStorage.setItem("colors_matrix",JSON.stringify(g))):alert("Could not load the board")}function F(e,t){const o=document.getElementById("board");o.innerHTML="";for(let l=0;l<e;l++){const n=document.createElement("tr");for(let r=0;r<e;r++){const a=document.createElement("td"),s=t[l][r];a.id=`cell_${l}_${r}`,a.className=`cell_color_${s}`,n.appendChild(a)}o.appendChild(n)}}let u={grid:null,visual_help:null,theme:null,difficulty:null,size:null};const c=document;function ne(){const e=localStorage.getItem("stored_selections");if(e)try{u=JSON.parse(e),c.getElementById("grid_selector").value=u.grid,c.getElementById("visual_settings").value=u.visual_help,c.getElementById("theme_selector").value=u.theme,c.getElementById("dificulty").value=u.difficulty,c.getElementById("size").value=u.size}catch(t){console.warn("Error parsing stored selections",t)}}function h(){u.grid=c.getElementById("grid_selector").value,u.visual_help=c.getElementById("visual_settings").value,u.theme=c.getElementById("theme_selector").value,u.difficulty=c.getElementById("dificulty").value,u.size=c.getElementById("size").value,localStorage.setItem("stored_selections",JSON.stringify(u))}window.addEventListener("DOMContentLoaded",ne);window.addEventListener("beforeunload",h);c.getElementById("grid_selector").addEventListener("change",h);c.getElementById("visual_settings").addEventListener("change",h);c.getElementById("theme_selector").addEventListener("change",h);c.getElementById("dificulty").addEventListener("change",h);c.getElementById("size").addEventListener("change",h);
